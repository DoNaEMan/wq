!function(){function t(t,s){this.isWindow=t===window,this.wapper="string"==typeof t?document.querySelector(t):this.isWindow?window:t,this.scroller=this.wapper.querySelector(".native-scroller"),this.opts={PULLDOWNTIPS:"下拉加载更多...",PULLDOWNTIPS2:"释放可刷新",PULLDOWNTIPS3:"正在加载中...",PULLUPTIPS:"正在刷新中...",PULLUPEND:"已经没有更多了",animateSpeed:100,borderColor:"#0394fb",offetTop:"0px",offetBottom:"0px"},xy.utils.extend(this.opts,s||{}),this._init()}t.prototype={version:"1.0.0",_init:function(){var t=this;this.pullUpBox=xy.html('<div class="native-pull-up"><div class="wrap"><canvas class="circle-ani" height="100" width="100"></canvas><div class="tips"></div></div></div>'),this.scroller.appendChild(this.pullUpBox),this.pullUpTips=this.pullUpBox.querySelector(".tips"),this.pullUpTips.innerHTML=this.opts.PULLUPTIPS,this.pullDownBox=xy.html('<div class="native-pull-down"><div class="wrap"><canvas height="100" width="100"></canvas><div class="tips"></div></div></div>'),document.body.insertBefore(this.pullDownBox,document.body.children[0]),this.pullDownBox.querySelector(".tips"),this.pullDownTips=this.pullDownBox.querySelector(".tips"),this.pullDownTips.innerHTML=this.opts.PULLDOWNTIPS,this.pullUpBoxHeight=this.pullUpBox.offsetHeight,this.scroller.style.paddingBottom=this.opts.offetBottom,this.scroller.style.paddingTop=this.opts.offetTop,this.pullDownBox.style.top=this.opts.offetTop,this.pullDownCanvas=this.pullDownBox.querySelector("canvas"),this.pullUpCanvas=this.pullUpBox.querySelector("canvas"),this._drawCircle(100,2),this.refresh(),this.wapper.addEventListener("scroll",this,!1),touch.on(this.wapper,"drag dragend",function(s){"drag"===s.type?t._move.call(t,s):t._end.call(t,s)})},getScrollTop:function(){return this.isWindow?document.body.scrollTop||document.documentElement.scrollTop:this.wapper.scrollTop},setScrollTop:function(t){if(!this.isWindow)return this.wapper.scrollTop=t;document.body.scrollTop=t,document.documentElement.scrollTop=t},refresh:function(t){this.maxScrollY=this.isWindow?window.innerHeight-document.body.offsetHeight:this.wapper.offsetHeight-this.scroller.offsetHeight,this.maxScrollY=this.maxScrollY<0?-this.maxScrollY:0,this.pullUpRefreshing=this.pullDownRefreshing=!1,this.ratio=0},pullUpOver:function(t){t?(this._setTipsStyle("u2"),this.pullUpEnd=!0):(this._setTipsStyle("u1"),this.pullUpEnd=!1),this.refresh()},pullDownOver:function(t){this.pullUpOver(t),this._setTipsStyle("d1"),this.refresh()},_drawCircle:function(t,s){if(!this.pullUpRefreshing&&!this.pullDownRefreshing){var i,l,e=2*Math.PI/360;i=1===s?this.pullDownCanvas:this.pullUpCanvas,t=t>=100?100:t<=0?0:t,i.getContext&&(l=i.getContext("2d"),l.beginPath(),l.clearRect(0,0,100,100),l.strokeStyle=this.opts.borderColor,l.lineWidth=12,l.arc(50,50,43,-80*e,(3.4*t-80)*e,!1),l.stroke())}},scrollTo:function(t){this.setScrollTop(t)},_setTipsStyle:function(t){switch(t){case"u1":this.pullUpTips.innerHTML=this.opts.PULLUPTIPS,this.pullUpCanvas.style.display="block",this.pullUpBox.style.display="block";break;case"u2":this.pullUpTips.innerHTML=this.opts.PULLUPEND,this.pullUpCanvas.style.display="none",this.pullUpBox.style.display="block";break;case"u3":this.pullUpBox.style.display="none";break;case"d1":var s=this.pullDownBox.style;this.pullDownTips.innerHTML=this.opts.PULLDOWNTIPS,s.opacity=0,s.display="none",this.pullDownCanvas.classList.remove("circle-ani"),this._drawCircle(0,1);break;case"d2":var s=this.pullDownBox.style;s.opacity=this.ratio,s.display="block",this._drawCircle(100*this.ratio,1);break;case"d3":this.pullDownTips.innerHTML=this.opts.PULLDOWNTIPS2,this._drawCircle(100,1);break;case"d4":this.pullDownTips.innerHTML=this.opts.PULLDOWNTIPS3,this.pullDownBox.style.display="block",this.pullDownCanvas.classList.add("circle-ani"),this._drawCircle(100,1)}},_move:function(t){this.pullDownRefreshing||this.pullUpRefreshing||("down"===t.direction&&0===this.getScrollTop()?(this.ratio=Math.abs(t.y)/this.opts.animateSpeed,this.ratio=this.ratio>1?1:this.ratio,this.ratio>=1?this._setTipsStyle("d3"):this._setTipsStyle("d2")):(this.ratio=0,this._setTipsStyle("d1")))},_end:function(t){this.pullDownRefreshing||this.pullUpRefreshing||(this.ratio>=1?(this._setTipsStyle("d4"),this.opts.pullDownCallBack&&this.opts.pullDownCallBack(),this.pullDownRefreshing=!0):this._setTipsStyle("d1"))},handleEvent:function(t){this.pullDownRefreshing&&this._setTipsStyle("u3"),this.pullDownRefreshing||this.pullUpRefreshing||(this.getScrollTop()>=this.maxScrollY-this.pullUpBoxHeight&&!this.pullUpEnd&&(this.pullUpRefreshing=!0,this.opts.pullUpCallBack&&this.opts.pullUpCallBack()),this.opts.scroll&&this.opts.scroll())}},window.NativeRefresh=t}();